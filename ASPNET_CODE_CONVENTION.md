# Этот документ описывает основные правила написания кода для проектов типа `ASP.NET`

## Базовые настройки проекта (Basic project settings)
- Проект должен иметь единый родительский класс контроллера. *Ниже описано более подробное описание реализации родительскиого контроллера:*
    - Родительский контроллер должен находится в корневой папке с контроллерами.
    - Родительский контроллер должен быть абстрактным.
    - Родительский контроллер должен иметь конструктор с обязательным параметром `IMediator`, также должно быть свойство `Mediator` с модификатор доступа `protected` для его использования.
    - Родительский контроллер должен иметь аттрибуты описанные ниже:
        - `[Authorize]`
        - `[ApiController]`
    - Родительский контроллер должен иметь свойства для получения данных из текущего контекста HTTP (Все свойства должны иметь модификатор доступа `protected`). *Ниже приведены свойства которые должны присутствовать в родительском контроллере:*
        - `UserId` **not null**
        - `Role` **not null**
        - `Email` (Опционально)
        - `Phone` (Опционально)
        - `Name` (Опционально)
        - `Country` (Опционально)
        - `DateOfBirth` (Опционально)
- Проект должен иметь глобальный обработчик исключений. *Ниже описано более подробное описание реализации глобального обработчика ошибок:*
    - Обработчик исключений должен реализовывать интерфейс `IExceptionHandler`.
    - При возникшем исключении обработчик должен отдавать в ответ соответствующий статус код, и объект `ProblemDetails` с типом `RFC7231`.
    - Запрешается передача подробной информации об ошибки в ответе.
    - Обработчик должен логгировать все возникшие исключения.
    - Обработчик может отдавать сообщение об ошибке если это исключение является кастомным и предусматривает передачу сообщения об ошибке в ответ.
- ASP.NET проект должен иметь папку `Extensions` в которой будут находится все методы расширений для `IServiceCollection`.
- Не допускается подключение всех сервисов в одном файле (Startup/Program).
- Каждый компонент должен находится в отдельном методе расширения (Authorization, Swagger, CORS, и другие)

## Контроллеры (Controllers)
- Все контроллеры должны иметь постфикс `Controller`.
- Все контроллеры должны наследоваться от родительского класса контроллера.
- Контроллеры которые поддерживают неавторизованный доступ должны быть помечены аттрибутом `[AllowAnonymous]`.
- Контроллеры должны иметь аттрибут `[Route("api/{version}/")]`.
- Не допускается наличение любой логики в конструкторе контроллера.

## Конечные точки (Endpoints)
- Необходимо придерживаться архитектурному стилю `REST`.
- Не допускается наличение любой логики в методе эндпоинта, необходимо ограничиться вызовом соответствующего медиатора.
- Запрещается использовать модели данных в качестве ответа.
- У всех эндпоинтов должен быть явно указан возвращаемый тип `IActionResult` или же `Task<IActionResult>`.
- Все асинхронные эндпоинты должны иметь обязательный параметр `CancellationToken`.
- Все эндпоинты которые предназначены для получения коллекции объектов должны иметь обязательные параметры `int skip` и `int take` для пагинации.
- Все эндпоинты должны быть помечены аттрибутом с соответствующим HTTP методом `[HttpGet]`, `[HttpPost]`, `[HttpPut]`, `[HttpPatch]`, `[HttpDelete]`, `[HttpHead]`. *Если есть несколько эндпоинтов с одинаковым HTTP методом, необходимо указать путь к этому эндпоинту в соответствующем аттрибуте*.
- Если эндпоинт имеет параметры необходимо через аттрибут явно указать куда передавать параметр `[FromQuery]`, `[FromRoute]`, `[FromBody]`, `[FromForm]`, `[FromHeader]`
- Все эндпоинты должны быть явно задокументированны через аттрибуты `[SwaggerOperation]`, `[ProducesResponseType]`
